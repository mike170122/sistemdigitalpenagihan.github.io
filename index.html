<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pengelolaan Penagihan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        .offline-overlay {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar-btn {
            color: #6b7280;
        }
        .sidebar-btn:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        .sidebar-btn.active {
            background-color: #dbeafe;
            color: #2563eb;
            font-weight: 600;
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 font-sans">
    <!-- Offline Notice -->
    <div id="offlineNotice" class="fixed inset-0 offline-overlay flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 mx-4 text-center max-w-md">
            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-moon text-gray-600 text-3xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Aplikasi Sedang Offline</h2>
            <p class="text-gray-600 mb-4">Sistem penagihan beroperasi dari jam 07:00 - 23:00</p>
            <p class="text-sm text-gray-500">Silakan kembali pada jam operasional</p>
            <div id="currentTime" class="mt-4 text-lg font-semibold text-indigo-600"></div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 fade-in">
            <div class="p-6 sm:p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-file-invoice-dollar text-white text-2xl"></i>
                    </div>
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Sistem Penagihan</h2>
                    <p class="text-gray-600 mt-2 text-sm sm:text-base">Kelola data penagihan dengan mudah</p>
                </div>

                <!-- Login Form -->
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                    </div>
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105 text-sm sm:text-base">
                        Masuk
                    </button>
                </form>

                <!-- Register Form (Hidden) -->
                <form id="registerForm" class="space-y-4 hidden">
                    <div>
                        <label for="registerName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                        <input type="text" id="registerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                    </div>
                    <div>
                        <label for="registerEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="registerEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                    </div>
                    <div>
                        <label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="registerPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                    </div>
                    <div>
                        <label for="registerRole" class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                        <select id="registerRole" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                            <option value="">Pilih Role</option>
                            <option value="admin">Admin</option>
                            <option value="user">User</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all transform hover:scale-105 text-sm sm:text-base">
                        Daftar
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <button id="toggleAuth" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                        Belum punya akun? Daftar di sini
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden h-full flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg border-r border-gray-200 flex flex-col">
            <!-- Sidebar Header -->
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-file-invoice-dollar text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-800">Sistem Penagihan</h1>
                        <p class="text-xs text-gray-600" id="userWelcome">Selamat datang!</p>
                    </div>
                </div>
            </div>

            <!-- Sidebar Navigation -->
            <nav class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <button class="sidebar-btn active w-full text-left px-4 py-3 rounded-lg transition-colors" data-tab="dashboard">
                            <i class="fas fa-tachometer-alt mr-3 w-4"></i>Dashboard
                        </button>
                    </li>
                    <li>
                        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-4 py-2">Data Tagihan</div>
                        <ul class="space-y-1">
                            <li>
                                <button class="sidebar-btn w-full text-left px-4 py-2 rounded-lg transition-colors text-sm" data-tab="billing">
                                    <i class="fas fa-plus-circle mr-3 w-4"></i>Tambah Tagihan
                                </button>
                            </li>
                            <li>
                                <button class="sidebar-btn w-full text-left px-4 py-2 rounded-lg transition-colors text-sm" data-tab="history">
                                    <i class="fas fa-list mr-3 w-4"></i>Kelola Tagihan
                                </button>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-4 py-2 mt-4">Laporan</div>
                        <ul class="space-y-1">
                            <li>
                                <button class="sidebar-btn w-full text-left px-4 py-2 rounded-lg transition-colors text-sm" data-tab="reports" id="reportsTab" style="display: none;">
                                    <i class="fas fa-chart-bar mr-3 w-4"></i>Laporan & Export
                                </button>
                            </li>
                        </ul>
                    </li>
                    <li id="adminSection" style="display: none;">
                        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider px-4 py-2 mt-4">Admin</div>
                        <ul class="space-y-1">
                            <li>
                                <button class="sidebar-btn w-full text-left px-4 py-2 rounded-lg transition-colors text-sm" data-tab="users" id="usersTab">
                                    <i class="fas fa-users mr-3 w-4"></i>Kelola User
                                </button>
                            </li>
                            <li>
                                <button class="sidebar-btn w-full text-left px-4 py-2 rounded-lg transition-colors text-sm" data-tab="generate" id="generateTab">
                                    <i class="fas fa-magic mr-3 w-4"></i>Generate Data
                                </button>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>

            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-gray-200">
                <div class="text-xs text-gray-600 mb-2" id="liveTime"></div>
                <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-colors text-sm">
                    <i class="fas fa-sign-out-alt mr-2"></i>Keluar
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <h2 id="pageTitle" class="text-xl font-semibold text-gray-800">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Online</span>
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto bg-gray-50">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content p-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total Tagihan</p>
                                    <p class="text-2xl font-bold text-gray-800" id="totalBills">0</p>
                                </div>
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-file-invoice text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Lunas</p>
                                    <p class="text-2xl font-bold text-gray-800" id="paidBills">0</p>
                                </div>
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-yellow-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Pending</p>
                                    <p class="text-2xl font-bold text-gray-800" id="pendingBills">0</p>
                                </div>
                                <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-red-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Belum Lunas</p>
                                    <p class="text-2xl font-bold text-gray-800" id="overdueBills">0</p>
                                </div>
                                <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Tagihan Terbaru</h3>
                        <div class="overflow-x-auto">
                            <div id="recentBills" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Belum ada data tagihan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Billing Input Tab -->
                <div id="billing" class="tab-content hidden p-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-800" id="formTitle">Tambah Data Tagihan</h3>
                            <button id="cancelEdit" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                <i class="fas fa-times mr-2"></i>Batal Edit
                            </button>
                        </div>
                        <form id="billingForm" class="space-y-4">
                            <input type="hidden" id="editId" value="">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="customerName" class="block text-sm font-medium text-gray-700 mb-2">Nama Pelanggan</label>
                                <input type="text" id="customerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                            </div>
                            <div>
                                <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-2">No. Telepon</label>
                                <input type="tel" id="customerPhone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                            </div>
                        </div>
                        
                        <div>
                            <label for="customerAddress" class="block text-sm font-medium text-gray-700 mb-2">Alamat</label>
                            <textarea id="customerAddress" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base"></textarea>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="billAmount" class="block text-sm font-medium text-gray-700 mb-2">Jumlah Tagihan (Rp)</label>
                                <input type="number" id="billAmount" required min="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                            </div>
                            <div>
                                <label for="dueDate" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Jatuh Tempo</label>
                                <input type="date" id="dueDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="paymentMethod" class="block text-sm font-medium text-gray-700 mb-2">Metode Pembayaran</label>
                                <select id="paymentMethod" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                                    <option value="">Pilih Metode Pembayaran</option>
                                    <option value="tunai">Tunai</option>
                                    <option value="transfer">Transfer</option>
                                </select>
                            </div>
                            <div>
                                <label for="billStatus" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                <select id="billStatus" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                                    <option value="">Pilih Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="paid">Lunas</option>
                                    <option value="overdue">Belum Lunas</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label for="officerName" class="block text-sm font-medium text-gray-700 mb-2">Nama Petugas</label>
                            <select id="officerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base">
                                <option value="">Pilih Nama Petugas</option>
                                <option value="Mario Haulussy">Mario Haulussy</option>
                                <option value="Macho Haulussy">Macho Haulussy</option>
                                <option value="Ryan Pattiwael">Ryan Pattiwael</option>
                                <option value="Stevy Wuarlela">Stevy Wuarlela</option>
                                <option value="Stevian Lauluw">Stevian Lauluw</option>
                                <option value="Gilberd">Gilberd</option>
                                <option value="Glen Tansora">Glen Tansora</option>
                                <option value="Glen Ohman">Glen Ohman</option>
                            </select>
                        </div>

                        <div>
                            <label for="billDescription" class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                            <textarea id="billDescription" rows="3" placeholder="Masukkan keterangan tambahan (opsional)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base"></textarea>
                        </div>

                            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105 text-sm sm:text-base">
                                <i class="fas fa-save mr-2"></i><span id="submitText">Simpan Tagihan</span>
                            </button>
                    </form>
                </div>
            </div>

                <!-- History Tab -->
                <div id="history" class="tab-content hidden p-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
                            <h3 class="text-xl font-semibold text-gray-800">Kelola Data Tagihan</h3>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto">
                                <input type="text" id="searchInput" placeholder="Cari nama pelanggan..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                    <option value="">Semua Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="paid">Lunas</option>
                                    <option value="overdue">Belum Lunas</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <div id="billsList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Belum ada data tagihan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div id="reports" class="tab-content hidden p-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
                            <h3 class="text-xl font-semibold text-gray-800">Laporan & Export</h3>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto">
                                <button id="exportExcel" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                    <i class="fas fa-file-excel mr-2"></i>Export Excel
                                </button>
                                <button id="exportPDF" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                    <i class="fas fa-file-pdf mr-2"></i>Export PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-4">Ringkasan Bulanan</h4>
                                <div id="monthlyReport" class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Total Tagihan:</span>
                                        <span class="font-semibold" id="monthlyTotal">Rp 0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Sudah Dibayar:</span>
                                        <span class="font-semibold text-green-600" id="monthlyPaid">Rp 0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Belum Dibayar:</span>
                                        <span class="font-semibold text-red-600" id="monthlyUnpaid">Rp 0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-4">Metode Pembayaran</h4>
                                <div id="paymentMethodReport" class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Tunai:</span>
                                        <span class="font-semibold" id="cashCount">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Transfer:</span>
                                        <span class="font-semibold" id="transferCount">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Management Tab -->
                <div id="users" class="tab-content hidden p-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
                            <h3 class="text-xl font-semibold text-gray-800">Kelola User</h3>
                            <button id="addUserBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                <i class="fas fa-plus mr-2"></i>Tambah User
                            </button>
                        </div>
                        
                        <!-- Add User Form -->
                        <div id="addUserForm" class="hidden bg-gray-50 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-gray-800 mb-4">Tambah User Baru</h4>
                            <form id="userForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="newUserName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                    <input type="text" id="newUserName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                </div>
                                <div>
                                    <label for="newUserEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="newUserEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                </div>
                                <div>
                                    <label for="newUserPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                    <input type="password" id="newUserPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                </div>
                                <div>
                                    <label for="newUserRole" class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                                    <select id="newUserRole" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                        <option value="">Pilih Role</option>
                                        <option value="admin">Admin</option>
                                        <option value="user">User</option>
                                    </select>
                                </div>
                                <div class="sm:col-span-2 flex space-x-2">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                        <i class="fas fa-save mr-2"></i>Simpan User
                                    </button>
                                    <button type="button" id="cancelAddUser" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                        <i class="fas fa-times mr-2"></i>Batal
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Users List -->
                        <div id="usersList" class="space-y-3">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Generate Data Tab -->
                <div id="generate" class="tab-content hidden p-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-6">Generate Data Tagihan</h3>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                <p class="text-yellow-800 text-sm">Fitur ini akan membuat data tagihan dummy untuk testing. Data yang sudah ada tidak akan terhapus.</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div>
                                <label for="generateCount" class="block text-sm font-medium text-gray-700 mb-2">Jumlah Data yang Akan Dibuat</label>
                                <select id="generateCount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="10">10 Data</option>
                                    <option value="25">25 Data</option>
                                    <option value="50">50 Data</option>
                                    <option value="100">100 Data</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status Data</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="genPending" checked class="mr-2">
                                        <span class="text-sm">Pending</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="genPaid" checked class="mr-2">
                                        <span class="text-sm">Lunas</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="genOverdue" checked class="mr-2">
                                        <span class="text-sm">Belum Lunas</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button id="generateDataBtn" class="mt-6 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors font-semibold">
                            <i class="fas fa-magic mr-2"></i>Generate Data Tagihan
                        </button>
                        
                        <div id="generateProgress" class="hidden mt-4">
                            <div class="bg-gray-200 rounded-full h-2">
                                <div id="progressBar" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">Sedang membuat data...</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
        </main>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-6 mx-4 max-w-sm w-full text-center fade-in">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Berhasil!</h3>
            <p id="successMessage" class="text-gray-600 mb-4">Data berhasil disimpan</p>
            <button id="closeSuccessModal" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                OK
            </button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-6 mx-4 max-w-sm w-full text-center fade-in">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-trash text-red-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Konfirmasi Hapus</h3>
            <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus data tagihan ini? Tindakan ini tidak dapat dibatalkan.</p>
            <div class="flex space-x-3">
                <button id="cancelDelete" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Batal
                </button>
                <button id="confirmDelete" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                    Hapus
                </button>
            </div>
        </div>
    </div>

    <script>
        // Application state
        let currentUser = null;
        let bills = JSON.parse(localStorage.getItem('bills')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, name: 'Admin', email: 'admin@admin.com', password: 'admin123', role: 'admin' },
            { id: 2, name: 'User', email: 'user@user.com', password: 'user123', role: 'user' }
        ];

        // Check operating hours (7 AM to 11 PM)
        function checkOperatingHours() {
            const now = new Date();
            const hour = now.getHours();
            
            if (hour < 7 || hour >= 23) {
                document.getElementById('offlineNotice').classList.remove('hidden');
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                return false;
            } else {
                document.getElementById('offlineNotice').classList.add('hidden');
                return true;
            }
        }

        // Update live time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            const dateString = now.toLocaleDateString('id-ID');
            
            document.getElementById('liveTime').textContent = `${dateString} ${timeString}`;
            document.getElementById('currentTime').textContent = timeString;
        }

        // Initialize app
        function initApp() {
            if (!checkOperatingHours()) {
                setInterval(checkOperatingHours, 60000); // Check every minute
                setInterval(updateTime, 1000);
                return;
            }

            updateTime();
            setInterval(updateTime, 1000);
            setInterval(checkOperatingHours, 60000);

            // Check if user is logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        }

        // Authentication functions
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showMainApp();
            } else {
                showMessage('Email atau password salah!', 'error');
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const role = document.getElementById('registerRole').value;
            
            if (users.find(u => u.email === email)) {
                showMessage('Email sudah terdaftar!', 'error');
                return;
            }
            
            const newUser = {
                id: users.length + 1,
                name,
                email,
                password,
                role
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showMessage('Registrasi berhasil! Silakan login.', 'success');
            toggleAuthForm();
        });

        document.getElementById('toggleAuth').addEventListener('click', toggleAuthForm);

        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const toggleBtn = document.getElementById('toggleAuth');
            
            if (loginForm.classList.contains('hidden')) {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                toggleBtn.textContent = 'Belum punya akun? Daftar di sini';
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                toggleBtn.textContent = 'Sudah punya akun? Login di sini';
            }
        }

        function showMainApp() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userWelcome').textContent = `Selamat datang, ${currentUser.name}!`;
            
            // Show/hide admin-only sections based on user role
            const reportsTab = document.getElementById('reportsTab');
            const adminSection = document.getElementById('adminSection');
            
            if (currentUser.role === 'admin') {
                // Show admin features
                if (reportsTab) {
                    reportsTab.style.display = 'block';
                    reportsTab.parentElement.style.display = 'block';
                }
                if (adminSection) {
                    adminSection.style.display = 'block';
                }
                loadUsersList();
            } else {
                // Hide admin features for regular users
                if (reportsTab) {
                    reportsTab.style.display = 'none';
                    reportsTab.parentElement.style.display = 'none';
                }
                if (adminSection) {
                    adminSection.style.display = 'none';
                }
            }
            
            updateDashboard();
            loadBillsHistory();
        }

        // Logout function
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authModal').classList.remove('hidden');
        });

        // Tab navigation
        document.querySelectorAll('.sidebar-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                showTab(tabName);
            });
        });

        function showTab(tabName) {
            // Update sidebar buttons
            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'billing': 'Tambah Data Tagihan',
                'history': 'Kelola Data Tagihan',
                'reports': 'Laporan & Export',
                'users': 'Kelola User',
                'generate': 'Generate Data'
            };
            document.getElementById('pageTitle').textContent = titles[tabName] || 'Dashboard';
            
            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            
            if (tabName === 'reports') {
                updateReports();
            }
        }

        // CRUD Variables
        let editingId = null;
        let deleteId = null;

        // Billing form
        document.getElementById('billingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editId').value;
            
            const formData = {
                id: editId ? parseInt(editId) : Date.now(),
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerAddress: document.getElementById('customerAddress').value,
                amount: parseFloat(document.getElementById('billAmount').value),
                dueDate: document.getElementById('dueDate').value,
                paymentMethod: document.getElementById('paymentMethod').value,
                status: document.getElementById('billStatus').value,
                description: document.getElementById('billDescription').value,
                officerName: document.getElementById('officerName').value,
                createdAt: editId ? bills.find(b => b.id == editId).createdAt : new Date().toISOString(),
                createdBy: editId ? bills.find(b => b.id == editId).createdBy : currentUser.name,
                updatedAt: editId ? new Date().toISOString() : null,
                updatedBy: editId ? currentUser.name : null
            };
            
            if (editId) {
                // Update existing bill
                const index = bills.findIndex(b => b.id == editId);
                if (index !== -1) {
                    bills[index] = formData;
                    showSuccessModal('Data tagihan berhasil diperbarui!');
                }
            } else {
                // Add new bill
                bills.push(formData);
                showSuccessModal('Data tagihan berhasil disimpan!');
            }
            
            localStorage.setItem('bills', JSON.stringify(bills));
            
            // Reset form
            resetForm();
            
            // Update dashboard and history
            updateDashboard();
            loadBillsHistory();
        });

        // Cancel edit
        document.getElementById('cancelEdit').addEventListener('click', function() {
            resetForm();
        });

        // Reset form function
        function resetForm() {
            document.getElementById('billingForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('formTitle').textContent = 'Tambah Data Tagihan';
            document.getElementById('submitText').textContent = 'Simpan Tagihan';
            document.getElementById('cancelEdit').classList.add('hidden');
            editingId = null;
        }

        // Edit bill function
        function editBill(id) {
            const bill = bills.find(b => b.id == id);
            if (!bill) return;
            
            // Fill form with bill data
            document.getElementById('editId').value = bill.id;
            document.getElementById('customerName').value = bill.customerName;
            document.getElementById('customerPhone').value = bill.customerPhone;
            document.getElementById('customerAddress').value = bill.customerAddress;
            document.getElementById('billAmount').value = bill.amount;
            document.getElementById('dueDate').value = bill.dueDate;
            document.getElementById('paymentMethod').value = bill.paymentMethod;
            document.getElementById('billStatus').value = bill.status;
            document.getElementById('billDescription').value = bill.description || '';
            document.getElementById('officerName').value = bill.officerName || '';
            
            // Update form UI
            document.getElementById('formTitle').textContent = 'Edit Data Tagihan';
            document.getElementById('submitText').textContent = 'Update Tagihan';
            document.getElementById('cancelEdit').classList.remove('hidden');
            
            // Switch to billing tab
            showTab('billing');
            editingId = id;
        }

        // Delete bill function
        function deleteBill(id) {
            deleteId = id;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        // Delete modal handlers
        document.getElementById('cancelDelete').addEventListener('click', function() {
            document.getElementById('deleteModal').classList.add('hidden');
            deleteId = null;
        });

        document.getElementById('confirmDelete').addEventListener('click', function() {
            if (deleteId) {
                bills = bills.filter(b => b.id != deleteId);
                localStorage.setItem('bills', JSON.stringify(bills));
                
                showSuccessModal('Data tagihan berhasil dihapus!');
                updateDashboard();
                loadBillsHistory();
                
                document.getElementById('deleteModal').classList.add('hidden');
                deleteId = null;
            }
        });

        // Dashboard functions
        function updateDashboard() {
            const totalBills = bills.length;
            const paidBills = bills.filter(bill => bill.status === 'paid').length;
            const pendingBills = bills.filter(bill => bill.status === 'pending').length;
            const overdueBills = bills.filter(bill => bill.status === 'overdue').length;
            
            document.getElementById('totalBills').textContent = totalBills;
            document.getElementById('paidBills').textContent = paidBills;
            document.getElementById('pendingBills').textContent = pendingBills;
            document.getElementById('overdueBills').textContent = overdueBills;
            
            // Show recent bills
            const recentBills = bills.slice(-5).reverse();
            const recentBillsContainer = document.getElementById('recentBills');
            
            if (recentBills.length === 0) {
                recentBillsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada data tagihan</p>';
            } else {
                recentBillsContainer.innerHTML = recentBills.map(bill => `
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 bg-gray-50 rounded-lg space-y-2 sm:space-y-0">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${bill.customerName}</h4>
                            <p class="text-sm text-gray-600">${bill.customerPhone}</p>
                            <p class="text-sm text-gray-500">${bill.paymentMethod}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-800">Rp ${bill.amount.toLocaleString('id-ID')}</p>
                            <span class="inline-block px-2 py-1 text-xs rounded-full ${getStatusColor(bill.status)}">${getStatusText(bill.status)}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // History functions
        function loadBillsHistory() {
            const billsList = document.getElementById('billsList');
            let filteredBills = [...bills];
            
            // Apply filters
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            
            if (searchTerm) {
                filteredBills = filteredBills.filter(bill => 
                    bill.customerName.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredBills = filteredBills.filter(bill => bill.status === statusFilter);
            }
            
            if (filteredBills.length === 0) {
                billsList.innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada data yang ditemukan</p>';
            } else {
                billsList.innerHTML = filteredBills.reverse().map(bill => `
                    <div class="bg-white rounded-lg p-4 space-y-3 shadow-sm border border-gray-200">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-2 sm:space-y-0">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">${bill.customerName}</h4>
                                <p class="text-sm text-gray-600">${bill.customerPhone}</p>
                                <p class="text-sm text-gray-500">${bill.customerAddress}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold text-lg text-gray-800">Rp ${bill.amount.toLocaleString('id-ID')}</p>
                                <span class="inline-block px-3 py-1 text-sm rounded-full ${getStatusColor(bill.status)}">${getStatusText(bill.status)}</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm text-gray-600">
                            <div><strong>Jatuh Tempo:</strong> ${new Date(bill.dueDate).toLocaleDateString('id-ID')}</div>
                            <div><strong>Metode:</strong> ${bill.paymentMethod}</div>
                            <div><strong>Dibuat:</strong> ${new Date(bill.createdAt).toLocaleDateString('id-ID')}</div>
                        </div>
                        ${bill.officerName ? `<div class="text-sm text-gray-600"><strong>Petugas:</strong> ${bill.officerName}</div>` : ''}
                        ${bill.description ? `<div class="text-sm text-gray-600"><strong>Keterangan:</strong> ${bill.description}</div>` : ''}
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-gray-500">
                                Dibuat oleh: ${bill.createdBy}
                                ${bill.updatedAt ? `<br>Diperbarui: ${new Date(bill.updatedAt).toLocaleDateString('id-ID')} oleh ${bill.updatedBy}` : ''}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editBill(${bill.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                                <button onclick="deleteBill(${bill.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    <i class="fas fa-trash mr-1"></i>Hapus
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Search and filter
        document.getElementById('searchInput').addEventListener('input', loadBillsHistory);
        document.getElementById('statusFilter').addEventListener('change', loadBillsHistory);

        // Reports functions
        function updateReports() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyBills = bills.filter(bill => {
                const billDate = new Date(bill.createdAt);
                return billDate.getMonth() === currentMonth && billDate.getFullYear() === currentYear;
            });
            
            const totalAmount = monthlyBills.reduce((sum, bill) => sum + bill.amount, 0);
            const paidAmount = monthlyBills.filter(bill => bill.status === 'paid').reduce((sum, bill) => sum + bill.amount, 0);
            const unpaidAmount = totalAmount - paidAmount;
            
            document.getElementById('monthlyTotal').textContent = `Rp ${totalAmount.toLocaleString('id-ID')}`;
            document.getElementById('monthlyPaid').textContent = `Rp ${paidAmount.toLocaleString('id-ID')}`;
            document.getElementById('monthlyUnpaid').textContent = `Rp ${unpaidAmount.toLocaleString('id-ID')}`;
            
            // Payment method counts
            const cashCount = bills.filter(bill => bill.paymentMethod === 'tunai').length;
            const transferCount = bills.filter(bill => bill.paymentMethod === 'transfer').length;
            
            document.getElementById('cashCount').textContent = cashCount;
            document.getElementById('transferCount').textContent = transferCount;
        }

        // Export functions
        document.getElementById('exportExcel').addEventListener('click', function() {
            const ws = XLSX.utils.json_to_sheet(bills.map(bill => ({
                'Nama Pelanggan': bill.customerName,
                'No. Telepon': bill.customerPhone,
                'Alamat': bill.customerAddress,
                'Jumlah': bill.amount,
                'Jatuh Tempo': bill.dueDate,
                'Metode Pembayaran': bill.paymentMethod,
                'Status': bill.status,
                'Nama Petugas': bill.officerName || '',
                'Keterangan': bill.description || '',
                'Tanggal Dibuat': new Date(bill.createdAt).toLocaleDateString('id-ID'),
                'Dibuat Oleh': bill.createdBy
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Tagihan');
            XLSX.writeFile(wb, `data-tagihan-${new Date().toISOString().split('T')[0]}.xlsx`);
        });

        document.getElementById('exportPDF').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(16);
            doc.text('LAPORAN DATA TAGIHAN', 105, 20, { align: 'center' });
            doc.setFontSize(12);
            doc.text(`Tanggal Export: ${new Date().toLocaleDateString('id-ID')}`, 105, 30, { align: 'center' });
            
            // Table headers
            const headers = ['No', 'Nama', 'Telepon', 'Jumlah', 'Status', 'Metode', 'Petugas'];
            const colWidths = [15, 35, 25, 25, 20, 20, 30];
            let xPos = 20;
            let yPos = 50;
            
            // Draw header
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            headers.forEach((header, i) => {
                doc.text(header, xPos, yPos);
                xPos += colWidths[i];
            });
            
            // Draw line under header
            doc.line(20, yPos + 2, 190, yPos + 2);
            yPos += 10;
            
            // Draw data rows
            doc.setFont(undefined, 'normal');
            bills.forEach((bill, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                    
                    // Redraw header on new page
                    doc.setFont(undefined, 'bold');
                    xPos = 20;
                    headers.forEach((header, i) => {
                        doc.text(header, xPos, yPos);
                        xPos += colWidths[i];
                    });
                    doc.line(20, yPos + 2, 190, yPos + 2);
                    yPos += 10;
                    doc.setFont(undefined, 'normal');
                }
                
                xPos = 20;
                const rowData = [
                    (index + 1).toString(),
                    bill.customerName.substring(0, 15),
                    bill.customerPhone,
                    `Rp ${(bill.amount / 1000).toFixed(0)}K`,
                    getStatusText(bill.status),
                    bill.paymentMethod,
                    (bill.officerName || '-').substring(0, 12)
                ];
                
                rowData.forEach((data, i) => {
                    doc.text(data, xPos, yPos);
                    xPos += colWidths[i];
                });
                
                yPos += 8;
            });
            
            // Summary
            yPos += 10;
            doc.line(20, yPos, 190, yPos);
            yPos += 10;
            doc.setFont(undefined, 'bold');
            doc.text(`Total Data: ${bills.length}`, 20, yPos);
            doc.text(`Total Nilai: Rp ${bills.reduce((sum, bill) => sum + bill.amount, 0).toLocaleString('id-ID')}`, 20, yPos + 10);
            
            doc.save(`laporan-tagihan-${new Date().toISOString().split('T')[0]}.pdf`);
        });

        // User Management Functions
        function loadUsersList() {
            const usersList = document.getElementById('usersList');
            if (users.length === 0) {
                usersList.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada data user</p>';
            } else {
                usersList.innerHTML = users.map(user => `
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">${user.name}</h4>
                                <p class="text-sm text-gray-600">${user.email}</p>
                                <span class="inline-block px-2 py-1 text-xs rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">${user.role.toUpperCase()}</span>
                            </div>
                            <div class="flex space-x-2">
                                ${user.id > 2 ? `<button onclick="deleteUser(${user.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    <i class="fas fa-trash mr-1"></i>Hapus
                                </button>` : '<span class="text-xs text-gray-500">Default User</span>'}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Add User Form Handlers
        document.getElementById('addUserBtn').addEventListener('click', function() {
            document.getElementById('addUserForm').classList.remove('hidden');
        });

        document.getElementById('cancelAddUser').addEventListener('click', function() {
            document.getElementById('addUserForm').classList.add('hidden');
            document.getElementById('userForm').reset();
        });

        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            
            if (users.find(u => u.email === email)) {
                showSuccessModal('Email sudah terdaftar!');
                return;
            }
            
            const newUser = {
                id: Math.max(...users.map(u => u.id)) + 1,
                name,
                email,
                password,
                role
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showSuccessModal('User berhasil ditambahkan!');
            loadUsersList();
            document.getElementById('addUserForm').classList.add('hidden');
            this.reset();
        });

        function deleteUser(id) {
            if (id <= 2) {
                showSuccessModal('User default tidak dapat dihapus!');
                return;
            }
            
            users = users.filter(u => u.id !== id);
            localStorage.setItem('users', JSON.stringify(users));
            showSuccessModal('User berhasil dihapus!');
            loadUsersList();
        }

        // Generate Data Functions
        document.getElementById('generateDataBtn').addEventListener('click', function() {
            const count = parseInt(document.getElementById('generateCount').value);
            const includePending = document.getElementById('genPending').checked;
            const includePaid = document.getElementById('genPaid').checked;
            const includeOverdue = document.getElementById('genOverdue').checked;
            
            if (!includePending && !includePaid && !includeOverdue) {
                showSuccessModal('Pilih minimal satu status untuk generate data!');
                return;
            }
            
            generateDummyData(count, { includePending, includePaid, includeOverdue });
        });

        function generateDummyData(count, options) {
            const progress = document.getElementById('generateProgress');
            const progressBar = document.getElementById('progressBar');
            
            progress.classList.remove('hidden');
            
            const names = [
                'Ahmad Wijaya', 'Siti Nurhaliza', 'Budi Santoso', 'Dewi Sartika', 'Eko Prasetyo',
                'Fitri Handayani', 'Gunawan Susanto', 'Hesti Purnamasari', 'Indra Kusuma', 'Joko Widodo',
                'Kartika Sari', 'Lukman Hakim', 'Maya Sari', 'Nanda Pratama', 'Oki Setiana',
                'Putri Maharani', 'Qori Sandioriva', 'Rini Soemarno', 'Sari Nila', 'Tono Suratman'
            ];
            
            const addresses = [
                'Jl. Merdeka No. 123, Jakarta', 'Jl. Sudirman No. 456, Bandung', 'Jl. Thamrin No. 789, Surabaya',
                'Jl. Gatot Subroto No. 321, Medan', 'Jl. Ahmad Yani No. 654, Semarang', 'Jl. Diponegoro No. 987, Yogyakarta',
                'Jl. Veteran No. 147, Malang', 'Jl. Pahlawan No. 258, Denpasar', 'Jl. Pemuda No. 369, Palembang'
            ];
            
            const officers = [
                'Mario Haulussy', 'Macho Haulussy', 'Ryan Pattiwael', 'Stevy Wuarlela',
                'Stevian Lauluw', 'Gilberd', 'Glen Tansora', 'Glen Ohman'
            ];
            
            const statuses = [];
            if (options.includePending) statuses.push('pending');
            if (options.includePaid) statuses.push('paid');
            if (options.includeOverdue) statuses.push('overdue');
            
            const methods = ['tunai', 'transfer'];
            
            let generated = 0;
            const interval = setInterval(() => {
                if (generated >= count) {
                    clearInterval(interval);
                    progress.classList.add('hidden');
                    progressBar.style.width = '0%';
                    showSuccessModal(`Berhasil generate ${count} data tagihan!`);
                    updateDashboard();
                    loadBillsHistory();
                    return;
                }
                
                // Generate batch of 5 data at once
                const batchSize = Math.min(5, count - generated);
                for (let i = 0; i < batchSize; i++) {
                    const randomName = names[Math.floor(Math.random() * names.length)];
                    const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
                    const randomOfficer = officers[Math.floor(Math.random() * officers.length)];
                    const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                    const randomMethod = methods[Math.floor(Math.random() * methods.length)];
                    
                    const bill = {
                        id: Date.now() + Math.random(),
                        customerName: randomName,
                        customerPhone: `08${Math.floor(Math.random() * 1000000000).toString().padStart(9, '0')}`,
                        customerAddress: randomAddress,
                        amount: Math.floor(Math.random() * 5000000) + 100000, // 100K - 5M
                        dueDate: new Date(Date.now() + Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        paymentMethod: randomMethod,
                        status: randomStatus,
                        description: `Tagihan ${randomMethod} - Generated Data`,
                        officerName: randomOfficer,
                        createdAt: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                        createdBy: 'System Generator'
                    };
                    
                    bills.push(bill);
                    generated++;
                }
                
                localStorage.setItem('bills', JSON.stringify(bills));
                
                const progressPercent = (generated / count) * 100;
                progressBar.style.width = `${progressPercent}%`;
            }, 100);
        }

        // Utility functions
        function getStatusColor(status) {
            switch (status) {
                case 'paid': return 'bg-green-100 text-green-800';
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'overdue': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'paid': return 'Lunas';
                case 'pending': return 'Pending';
                case 'overdue': return 'Belum Lunas';
                default: return 'Unknown';
            }
        }

        function showMessage(message, type) {
            // Simple message display - you can enhance this
            if (type === 'error') {
                document.getElementById('successMessage').textContent = message;
                document.getElementById('successModal').classList.remove('hidden');
            }
        }

        function showSuccessModal(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.remove('hidden');
        }

        document.getElementById('closeSuccessModal').addEventListener('click', function() {
            document.getElementById('successModal').classList.add('hidden');
        });

        // Initialize the application
        initApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'993fa6ece46dfe08',t:'MTc2MTM3MzY4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
